{% set repositories_present, count_to_display_repo, org_details, do_not_use, datasets_modified = h.repositories_dataset_present_count() %}

<style>
/* wrapper for whole section */
.featured-org-wrapper {
  background: #f7f7f7;
  padding: 2rem 1rem;
  border-radius: 8px;
  margin-bottom: 2rem;
}

/* grid of cards */
.media-grid {
  display: inherit;     /* inherit from parent */
  gap: 1.5rem;
  align-items: stretch;
  padding-left: initial;

}

/* force 2 items per row regardless of parent layout */
.media-item {
  width: calc(50% - 1.5rem);
  min-width: calc(50% - 1.5rem);
  max-width: calc(50% - 1.5rem);

  /* force equal height for all cards in the same row */
  display: flex;
  flex-direction: column;
}


/* one card */
.media-item {
  flex: 1 1 calc(50% - 1.5rem); /* 2 per row */
  min-width: 300px;
  max-width: 500px;
  background: #fff;
  border-radius: 6px;
  padding: 1rem 1.25rem;
  box-shadow: 0 1px 6px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
}

/* clickable header wrapper */
.module-heading-link {
  display: block;
  text-decoration: none;
  color: inherit; /* keep CKAN default text color */
}

/* header background */
.module-heading {
  background: #f5f5f5;
  border-radius: 6px;
  margin-bottom: 0.75rem;
  padding: 0;                /* padding handled inside */
  min-height: 52px;          /* force same height everywhere */
  display: flex;
  align-items: stretch;
  transition: background 0.15s ease, box-shadow 0.15s ease;
}

/* hover effect: whole header changes */
.module-heading-link:hover .module-heading {
  background: #e9ecef;       /* subtle CKAN-like grey */
  box-shadow: 0 0 0 2px rgba(0,0,0,0.04) inset;
  cursor: pointer;
  text-decoration: none !important;

}

/* row: text on left, icon on right */
.fo-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 0.6rem 0.9rem;
  gap: 0.75rem;
}

/* left side: title + last update */
.fo-left {
  flex: 1 1 auto;
  min-width: 0;
}

.fo-title {
  font-size: 1.5rem;
  font-weight: 600;
  margin: 0 0 0.2rem 0;
  line-height: 1.3;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: #206b82
}

.fo-meta {
  font-size: 1.2rem;
  color: #555;
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

.fo-meta .fa {
  font-size: 1rem;
}

/* right side: fixed-size icon area */
.fo-logo {
  flex: 0 0 60px;     /* same width in all headers */
  height: 40px;       /* same height in all headers */
  display: flex;
  align-items: center;
  justify-content: center;
}

/* image always fits nicely inside box */
.fo-logo img {
  width: 40px;
  height: 40px;
  object-fit: contain;   /* keeps any logo nicely inside */
}

/* --- dataset list --- */

.dataset-list {
  list-style: disc;
  padding-left: 1.5rem;
  margin: 0.5rem 0 0 0;
  text-align: left;
}

.dataset-list li {
  font-size: 1.3rem;
  margin: 0.25rem 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.dataset-list li a {
  color: #333;
  text-decoration: none;
}

.dataset-list li a:hover {
  text-decoration: underline;
}

/* responsive: 1 per row on small screens */
@media (max-width: 768px) {
  .media-item {
    flex: 1 1 100%;
    max-width: 100%;
  }
}
</style>

<div class="featured-org-wrapper">
  <h3 style="text-align:center">Latest Datasets</h3>

  <div class="media-grid">
    {% for repository in org_details %}
      <div class="media-item">

        <a class="module-heading-link"
           href="{{ h.url_for('organization.about', id=repository.name) }}">
          <header class="module-heading">
            <div class="fo-header">
              <div class="fo-left">
                <h3 class="fo-title">
                  {{ repository.title or repository.name }}
                </h3>

                {% if h.org_last_harvest_time(repository.id) %}
                  <div class="fo-meta">
                    <i class="fa fa-clock-o" aria-hidden="true"></i>
                    Last Update&nbsp; {{ h.org_last_harvest_time(repository.id) }}
                  </div>
                {% endif %}
              </div>

              <div class="fo-logo">
                <img
                  src="{{ repository.image_display_url
                          or h.url_for_static('/base/images/placeholder-organization.png') }}"
                  alt="{{ repository.title }}">
              </div>
            </div>
          </header>
        </a>

        {% if repository.packages %}
          <ul class="dataset-list">
            {% for ds in repository.packages %}
              <li>
                {{ ds.metadata_created.split('T')[0].split('-') | reverse | join('-') }}
                &nbsp;&nbsp;&nbsp;
                <a href="{{ h.url_for(ds.type ~ '.read', id=ds.name) }}">
                  {{ ds.title | truncate(50, True) }}
                </a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p style="font-size: 1rem; color: #333;">No datasets available</p>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>
